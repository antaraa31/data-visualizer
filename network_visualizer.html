<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Network Traffic Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Live Network Traffic Visualizer ðŸ“Š</h1>
            <p class="mt-2 text-lg text-gray-600">Real-time dashboard of your computer's network activity.</p>
        </header>
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="bg-white p-6 rounded-2xl shadow-lg lg:col-span-1"><h2 class="text-xl font-semibold mb-4 text-center">Protocol Breakdown</h2><div class="relative h-64 md:h-80"><canvas id="protocolChart"></canvas></div></div>
            <div class="bg-white p-6 rounded-2xl shadow-lg lg:col-span-2"><h2 class="text-xl font-semibold mb-4 text-center">Top 5 Communicating IPs</h2><div class="relative h-64 md:h-80"><canvas id="ipChart"></canvas></div></div>
            <div class="bg-white p-6 rounded-2xl shadow-lg lg:col-span-3"><h2 class="text-xl font-semibold mb-4 text-center">Live Network Speed</h2><div class="relative h-64 md:h-96"><canvas id="speedChart"></canvas></div></div>
        </main>
    </div>
    <script>
        const protocolCtx = document.getElementById('protocolChart').getContext('2d');
        const ipCtx = document.getElementById('ipChart').getContext('2d');
        const speedCtx = document.getElementById('speedChart').getContext('2d');
        const protocolChart = new Chart(protocolCtx, { type: 'pie', data: { labels: ['TCP', 'UDP', 'Other'], datasets: [{ data: [0, 0, 0], backgroundColor: ['rgba(54, 162, 235, 0.8)','rgba(255, 99, 132, 0.8)','rgba(255, 206, 86, 0.8)'], borderColor: ['rgba(54, 162, 235, 1)','rgba(255, 99, 132, 1)','rgba(255, 206, 86, 1)'], borderWidth: 1 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } } });
        const ipChart = new Chart(ipCtx, { type: 'bar', data: { labels: [], datasets: [{ label: 'Packets Count', data: [], backgroundColor: 'rgba(75, 192, 192, 0.7)', borderColor: 'rgba(75, 192, 192, 1)', borderWidth: 1 }] }, options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, scales: { x: { beginAtZero: true } }, plugins: { legend: { display: false } } } });
        const speedChart = new Chart(speedCtx, { type: 'line', data: { labels: [], datasets: [ { label: 'Download (KB/s)', data: [], borderColor: 'rgba(54, 162, 235, 1)', backgroundColor: 'rgba(54, 162, 235, 0.2)', fill: true, tension: 0.3 }, { label: 'Upload (KB/s)', data: [], borderColor: 'rgba(255, 99, 132, 1)', backgroundColor: 'rgba(255, 99, 132, 0.2)', fill: true, tension: 0.3 } ] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { callback: function(value) { return value + ' KB/s' } } } } } });
        async function fetchNetworkData() {
            try {
                const response = await fetch('http://127.0.0.1:5000/data');
                if (!response.ok) { console.error("Could not connect to the backend server."); return; }
                const data = await response.json();
                if (data && data.speed) { updateCharts(data); }
            } catch (error) { console.error("Error fetching data. Is the Python server running with admin rights?", error); }
        }
        function updateCharts(data) {
            const finalProtocolData = { TCP: 0, UDP: 0, Other: 0, ...data.protocols };
            protocolChart.data.datasets[0].data = [finalProtocolData.TCP, finalProtocolData.UDP, finalProtocolData.Other];
            protocolChart.update();
            const sortedIps = data.ips || [];
            ipChart.data.labels = sortedIps.map(item => item[0]);
            ipChart.data.datasets[0].data = sortedIps.map(item => item[1]);
            ipChart.update();
            const now = new Date();
            const timeLabel = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            const downloadKB = (data.speed.download / 1024).toFixed(2);
            const uploadKB = (data.speed.upload / 1024).toFixed(2);
            speedChart.data.labels.push(timeLabel);
            speedChart.data.datasets[0].data.push(downloadKB);
            speedChart.data.datasets[1].data.push(uploadKB);
            if (speedChart.data.labels.length > 30) {
                speedChart.data.labels.shift();
                speedChart.data.datasets.forEach(dataset => { dataset.data.shift(); });
            }
            speedChart.update();
        }
        setInterval(fetchNetworkData, 1000);
    </script>
</body>
</html>